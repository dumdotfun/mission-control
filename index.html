<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mission Control | Jack Daniels</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', system-ui, sans-serif; background: #05070c; color: #e2e8f0; font-size: 15px; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #ffffff15; border-radius: 3px; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const C = {
      bg: "#05070c", sf: "#0a0e17", cd: "#0c1019", inp: "#111827",
      br: "#ffffff0a", brH: "#ffffff14", tx: "#e2e8f0", sub: "#7b8ba3", mut: "#3e4a5e",
      cyan: "#00e5ff", grn: "#34d399", vio: "#a78bfa", org: "#fb923c",
      rose: "#f472b6", red: "#ef4444", yel: "#facc15", blue: "#60a5fa"
    };
    
    const PC = { high: C.red, medium: C.org, low: C.grn };
    const SL = { backlog: "Backlog", "in-progress": "In Progress", review: "Review", done: "Done" };
    
    const timeAgo = (ts) => {
      const d = Date.now() - new Date(ts).getTime();
      if (d < 60000) return "now";
      if (d < 3600000) return `${Math.floor(d/60000)}m`;
      if (d < 86400000) return `${Math.floor(d/3600000)}h`;
      return `${Math.floor(d/86400000)}d`;
    };
    
    const fmtDate = (ts) => new Date(ts).toLocaleString("en-US", { 
      month: "short", day: "numeric", hour: "2-digit", minute: "2-digit" 
    });

    const pill = (c, sm) => ({
      display: "inline-flex", alignItems: "center", padding: sm ? "4px 10px" : "5px 14px",
      borderRadius: 8, fontSize: sm ? 11 : 13, fontWeight: 600,
      background: `${c}18`, color: c, whiteSpace: "nowrap"
    });

    const btnS = (bg, sm) => ({
      padding: sm ? "8px 16px" : "12px 24px",
      background: bg === "ghost" ? "transparent" : bg,
      color: bg === "ghost" ? C.sub : [C.cyan, C.grn, C.yel].includes(bg) ? C.bg : "#fff",
      border: bg === "ghost" ? `1px solid ${C.brH}` : "none",
      borderRadius: 10, fontWeight: 600, fontSize: sm ? 13 : 14,
      cursor: "pointer", fontFamily: "inherit", transition: "all .15s"
    });

    const inpS = {
      width: "100%", padding: "12px 16px", background: C.inp,
      border: `1px solid ${C.brH}`, borderRadius: 10, color: C.tx,
      fontSize: 14, outline: "none", fontFamily: "inherit"
    };

    const lblS = {
      fontSize: 11, fontWeight: 700, textTransform: "uppercase",
      letterSpacing: 1.2, color: C.mut, display: "block", marginBottom: 6
    };

    const cardS = {
      background: C.cd, border: `1px solid ${C.br}`,
      borderRadius: 16, padding: 24, marginBottom: 20
    };

    function App() {
      const [data, setData] = React.useState(null);
      const [loading, setLoading] = React.useState(true);
      const [view, setView] = React.useState("dashboard");
      const [modal, setModal] = React.useState(null);
      const [taskForm, setTaskForm] = React.useState({ title: "", projectId: "", priority: "medium", notes: "" });

      React.useEffect(() => {
        fetch('./data.json')
          .then(r => r.ok ? r.json() : Promise.reject())
          .then(d => { setData(d); setLoading(false); })
          .catch(() => { 
            // Fallback data
            setData({
              version: "1.0",
              lastUpdated: new Date().toISOString(),
              agents: [{
                id: "jack-main", name: "Jack Daniels", emoji: "üîç",
                role: "Personal Assistant", status: "active",
                model: "anthropic/claude-opus-4-5", color: "#00e5ff"
              }],
              projects: [],
              tasks: [],
              activity: [],
              context: { currentFocus: "Ready for tasks", recentWins: [], blockers: [] }
            });
            setLoading(false);
          });
      }, []);

      const save = (newData) => {
        const updated = { ...newData, lastUpdated: new Date().toISOString() };
        setData(updated);
        // Save to localStorage for persistence between reloads
        localStorage.setItem('mission-control-data', JSON.stringify(updated));
      };

      const addTask = () => {
        if (!taskForm.title.trim()) return;
        const newTask = {
          id: `task-${Date.now()}`,
          ...taskForm,
          status: "backlog",
          created: new Date().toISOString()
        };
        const newActivity = {
          id: `act-${Date.now()}`,
          timestamp: new Date().toISOString(),
          action: `New task: "${taskForm.title}"`,
          agentId: "jack-main"
        };
        save({
          ...data,
          tasks: [newTask, ...(data.tasks || [])],
          activity: [newActivity, ...(data.activity || [])]
        });
        setTaskForm({ title: "", projectId: "", priority: "medium", notes: "" });
        setModal(null);
      };

      const moveTask = (id, status) => {
        save({
          ...data,
          tasks: data.tasks.map(t => t.id === id ? { ...t, status, ...(status === "done" ? { completedAt: new Date().toISOString() } : {}) } : t)
        });
      };

      const delTask = (id) => save({ ...data, tasks: data.tasks.filter(t => t.id !== id) });

      if (loading) return (
        <div style={{ height: "100vh", display: "flex", alignItems: "center", justifyContent: "center", background: C.bg }}>
          <div style={{ textAlign: "center" }}>
            <div style={{ fontSize: 48 }}>üîç</div>
            <div style={{ fontSize: 14, letterSpacing: 2, textTransform: "uppercase", marginTop: 12, color: C.cyan }}>
              Loading Mission Control...
            </div>
          </div>
        </div>
      );

      const agent = data?.agents?.[0];
      const activeTasks = data?.tasks?.filter(t => t.status !== "done") || [];
      const completedTasks = data?.tasks?.filter(t => t.status === "done") || [];

      return (
        <div style={{ display: "flex", height: "100vh", background: C.bg, color: C.tx, fontSize: 15, overflow: "hidden" }}>
          {/* Sidebar */}
          <div style={{ width: 280, background: C.sf, borderRight: `1px solid ${C.br}`, display: "flex", flexDirection: "column" }}>
            
            {/* Agent Card - TOP AND PROMINENT */}
            {agent && (
              <div style={{ padding: "20px 16px", borderBottom: `1px solid ${C.br}`, background: `linear-gradient(180deg, ${C.cyan}08 0%, transparent 100%)` }}>
                <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
                  <div style={{ 
                    width: 56, height: 56, borderRadius: "50%", 
                    background: `linear-gradient(135deg, ${C.cyan}30, ${C.vio}30)`,
                    border: `2px solid ${C.cyan}50`, 
                    display: "flex", alignItems: "center", justifyContent: "center", 
                    fontSize: 28, boxShadow: `0 0 20px ${C.cyan}20`
                  }}>{agent.emoji}</div>
                  <div style={{ flex: 1 }}>
                    <div style={{ fontWeight: 700, fontSize: 18, display: "flex", alignItems: "center", gap: 8 }}>
                      {agent.name}
                      <div style={{ width: 10, height: 10, borderRadius: "50%", background: agent.status === "active" ? C.grn : C.mut, boxShadow: agent.status === "active" ? `0 0 8px ${C.grn}` : "none" }} />
                    </div>
                    <div style={{ fontSize: 13, color: C.cyan, fontWeight: 500 }}>{agent.role}</div>
                    <div style={{ fontSize: 11, color: C.mut, marginTop: 4 }}>{agent.model?.split('/').pop()}</div>
                  </div>
                </div>
              </div>
            )}

            {/* Navigation */}
            <div style={{ padding: "12px 8px" }}>
              {[["dashboard", "üìä", "Dashboard"], ["kanban", "üìã", "Task Board"], ["projects", "üìÅ", "Projects"]].map(([v, i, l]) => (
                <button key={v} onClick={() => setView(v)} style={{
                  display: "flex", alignItems: "center", gap: 10, padding: "12px 16px", margin: "2px 0",
                  borderRadius: 10, cursor: "pointer", fontSize: 14, fontWeight: 500, width: "100%",
                  textAlign: "left", border: "none", fontFamily: "inherit",
                  color: view === v ? C.cyan : C.sub, background: view === v ? `${C.cyan}12` : "transparent"
                }}><span style={{ fontSize: 18 }}>{i}</span> {l}</button>
              ))}
            </div>

            {/* Stats */}
            <div style={{ padding: "16px", marginTop: "auto", borderTop: `1px solid ${C.br}` }}>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 }}>
                <div style={{ background: C.cd, borderRadius: 10, padding: 12, textAlign: "center" }}>
                  <div style={{ fontSize: 24, fontWeight: 800, color: C.cyan }}>{activeTasks.length}</div>
                  <div style={{ fontSize: 10, color: C.mut, textTransform: "uppercase", letterSpacing: 1 }}>Active</div>
                </div>
                <div style={{ background: C.cd, borderRadius: 10, padding: 12, textAlign: "center" }}>
                  <div style={{ fontSize: 24, fontWeight: 800, color: C.grn }}>{completedTasks.length}</div>
                  <div style={{ fontSize: 10, color: C.mut, textTransform: "uppercase", letterSpacing: 1 }}>Done</div>
                </div>
              </div>
            </div>

            <div style={{ padding: "12px 16px", borderTop: `1px solid ${C.br}` }}>
              <button onClick={() => setModal("task")} style={{ ...btnS(C.cyan), width: "100%", fontSize: 14 }}>+ New Task</button>
            </div>
          </div>

          {/* Main */}
          <div style={{ flex: 1, display: "flex", flexDirection: "column", overflow: "hidden" }}>
            <div style={{ padding: "16px 28px", borderBottom: `1px solid ${C.br}`, background: C.sf, display: "flex", alignItems: "center", justifyContent: "space-between" }}>
              <h2 style={{ fontSize: 20, fontWeight: 700 }}>
                {view === "dashboard" && "üìä Dashboard"}
                {view === "kanban" && "üìã Task Board"}
                {view === "projects" && "üìÅ Projects"}
              </h2>
              <div style={{ display: "flex", gap: 8, alignItems: "center" }}>
                <span style={{ fontSize: 12, color: C.mut }}>Updated {timeAgo(data?.lastUpdated)}</span>
                <span style={pill(C.grn, true)}>‚óè Synced</span>
              </div>
            </div>

            <div style={{ flex: 1, overflowY: "auto", padding: 28 }}>
              {/* Dashboard View */}
              {view === "dashboard" && (
                <div>
                  {/* Context */}
                  <div style={cardS}>
                    <h3 style={{ fontSize: 16, fontWeight: 700, marginBottom: 12 }}>üéØ Current Focus</h3>
                    <div style={{ fontSize: 18, color: C.tx, marginBottom: 16 }}>{data?.context?.currentFocus || "No focus set"}</div>
                    {data?.context?.recentWins?.length > 0 && (
                      <div>
                        <div style={{ fontSize: 12, color: C.mut, marginBottom: 6 }}>Recent Wins</div>
                        <div style={{ display: "flex", flexWrap: "wrap", gap: 6 }}>
                          {data.context.recentWins.map((w, i) => (
                            <span key={i} style={{ ...pill(C.grn, true) }}>‚úì {w}</span>
                          ))}
                        </div>
                      </div>
                    )}
                  </div>

                  <div style={{ display: "grid", gridTemplateColumns: "1fr 340px", gap: 20 }}>
                    {/* Tasks */}
                    <div style={cardS}>
                      <h3 style={{ fontSize: 16, fontWeight: 700, marginBottom: 16 }}>Active Tasks</h3>
                      {activeTasks.length === 0 && <div style={{ color: C.mut, fontSize: 14, fontStyle: "italic", padding: "20px 0" }}>No active tasks ‚Äî click "+ New Task" to add one</div>}
                      {activeTasks.slice(0, 10).map(t => (
                        <TaskRow key={t.id} t={t} move={moveTask} del={delTask} />
                      ))}
                    </div>

                    {/* Activity */}
                    <div style={cardS}>
                      <h3 style={{ fontSize: 16, fontWeight: 700, marginBottom: 16 }}>Activity</h3>
                      {(data?.activity || []).length === 0 && <div style={{ color: C.mut, fontSize: 14, fontStyle: "italic" }}>No activity yet</div>}
                      {(data?.activity || []).slice(0, 12).map(a => (
                        <div key={a.id} style={{ display: "flex", gap: 10, marginBottom: 14 }}>
                          <div style={{ width: 8, height: 8, borderRadius: "50%", background: C.cyan, marginTop: 6, flexShrink: 0 }} />
                          <div>
                            <div style={{ fontSize: 13, color: C.sub, lineHeight: 1.5 }}>{a.action}</div>
                            <div style={{ fontSize: 11, color: C.mut, fontFamily: "monospace" }}>{timeAgo(a.timestamp)}</div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              )}

              {/* Kanban View */}
              {view === "kanban" && (
                <div style={{ display: "grid", gridTemplateColumns: "repeat(4, 1fr)", gap: 16, alignItems: "start" }}>
                  {["backlog", "in-progress", "review", "done"].map(st => (
                    <div key={st}>
                      <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 14 }}>
                        <span style={{ fontSize: 12, fontWeight: 700, textTransform: "uppercase", letterSpacing: 1.5, color: C.mut }}>{SL[st]}</span>
                        <span style={pill(C.sub, true)}>{data?.tasks?.filter(t => t.status === st).length || 0}</span>
                      </div>
                      {data?.tasks?.filter(t => t.status === st).map(t => (
                        <div key={t.id} style={{ background: C.inp, border: `1px solid ${C.br}`, borderRadius: 12, padding: 16, marginBottom: 10 }}>
                          <div style={{ fontWeight: 600, fontSize: 14, marginBottom: 8 }}>{t.title}</div>
                          <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 10 }}>
                            <span style={{ fontSize: 11, color: C.mut }}>{timeAgo(t.created)}</span>
                            <span style={pill(PC[t.priority], true)}>{t.priority}</span>
                          </div>
                          <div style={{ display: "flex", gap: 4 }}>
                            {["backlog", "in-progress", "review", "done"].filter(s => s !== st).map(s => (
                              <button key={s} onClick={() => moveTask(t.id, s)} style={{
                                flex: 1, padding: "4px 0", background: C.br, border: "none",
                                borderRadius: 6, color: C.mut, fontSize: 10, cursor: "pointer", fontFamily: "inherit"
                              }}>‚Üí {SL[s].split(" ").pop()}</button>
                            ))}
                          </div>
                        </div>
                      ))}
                    </div>
                  ))}
                </div>
              )}

              {/* Projects View */}
              {view === "projects" && (
                <div>
                  {(!data?.projects || data.projects.length === 0) && (
                    <div style={{ ...cardS, textAlign: "center", padding: 40 }}>
                      <div style={{ fontSize: 36, marginBottom: 12 }}>üìÅ</div>
                      <div style={{ fontSize: 16, color: C.sub }}>No projects yet</div>
                      <div style={{ fontSize: 13, color: C.mut, marginTop: 8 }}>Projects will appear here as we work on them</div>
                    </div>
                  )}
                  {data?.projects?.map(p => (
                    <div key={p.id} style={cardS}>
                      <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 12 }}>
                        <h3 style={{ fontSize: 18, fontWeight: 700 }}>{p.name}</h3>
                        <span style={pill(p.status === "complete" ? C.grn : p.status === "in-progress" ? C.org : C.sub)}>
                          {p.status === "complete" ? "‚úì Complete" : p.status}
                        </span>
                      </div>
                      {p.details && (
                        <div style={{ fontSize: 13, color: C.sub }}>
                          {p.details.url && <div>URL: <a href={p.details.url} target="_blank" style={{ color: C.cyan }}>{p.details.url}</a></div>}
                          {p.details.repo && <div>Repo: <a href={p.details.repo} target="_blank" style={{ color: C.cyan }}>{p.details.repo}</a></div>}
                          {p.details.features && <div style={{ marginTop: 8 }}>{p.details.features.map((f, i) => <span key={i} style={{ ...pill(C.cyan, true), marginRight: 6, marginBottom: 6 }}>{f}</span>)}</div>}
                        </div>
                      )}
                      {p.completedAt && <div style={{ fontSize: 11, color: C.mut, marginTop: 10 }}>Completed {fmtDate(p.completedAt)}</div>}
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Task Modal */}
          {modal === "task" && (
            <div style={{ position: "fixed", inset: 0, background: "#000c", display: "flex", alignItems: "center", justifyContent: "center", zIndex: 1000 }} onClick={() => setModal(null)}>
              <div style={{ background: C.cd, border: `1px solid ${C.brH}`, borderRadius: 16, padding: 28, width: 460 }} onClick={e => e.stopPropagation()}>
                <h3 style={{ fontSize: 18, fontWeight: 700, marginBottom: 20 }}>New Task</h3>
                <div style={{ marginBottom: 14 }}>
                  <span style={lblS}>Title</span>
                  <input style={inpS} value={taskForm.title} onChange={e => setTaskForm({ ...taskForm, title: e.target.value })} placeholder="What needs to be done?" autoFocus />
                </div>
                <div style={{ marginBottom: 14 }}>
                  <span style={lblS}>Priority</span>
                  <div style={{ display: "flex", gap: 8 }}>
                    {["low", "medium", "high"].map(p => (
                      <button key={p} onClick={() => setTaskForm({ ...taskForm, priority: p })} style={{
                        flex: 1, padding: "10px 0",
                        background: taskForm.priority === p ? PC[p] : "transparent",
                        color: taskForm.priority === p ? "#fff" : C.sub,
                        border: taskForm.priority === p ? "none" : `1px solid ${C.brH}`,
                        borderRadius: 8, fontSize: 13, fontWeight: 600, cursor: "pointer",
                        fontFamily: "inherit", textTransform: "capitalize"
                      }}>{p}</button>
                    ))}
                  </div>
                </div>
                <div style={{ marginBottom: 20 }}>
                  <span style={lblS}>Notes</span>
                  <textarea style={{ ...inpS, resize: "vertical", minHeight: 60, lineHeight: 1.6 }} value={taskForm.notes} onChange={e => setTaskForm({ ...taskForm, notes: e.target.value })} placeholder="Details..." />
                </div>
                <div style={{ display: "flex", gap: 8, justifyContent: "flex-end" }}>
                  <button onClick={() => setModal(null)} style={btnS("ghost")}>Cancel</button>
                  <button onClick={addTask} style={btnS(C.cyan)}>Create Task</button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    function TaskRow({ t, move, del }) {
      const [open, setOpen] = React.useState(false);
      const done = t.status === "done";
      return (
        <div style={{ background: C.inp, border: `1px solid ${C.br}`, borderRadius: 12, padding: 14, marginBottom: 10, opacity: done ? 0.5 : 1 }}>
          <div style={{ display: "flex", alignItems: "center", gap: 10, cursor: "pointer" }} onClick={() => setOpen(!open)}>
            <div style={{ flex: 1, fontWeight: 600, fontSize: 14, textDecoration: done ? "line-through" : "none" }}>{t.title}</div>
            <span style={pill(PC[t.priority], true)}>{t.priority}</span>
            <span style={{ color: C.mut, fontSize: 11 }}>{open ? "‚ñ≤" : "‚ñº"}</span>
          </div>
          {open && (
            <div style={{ marginTop: 12, paddingTop: 12, borderTop: `1px solid ${C.br}` }}>
              <div style={{ fontSize: 11, color: C.mut, marginBottom: 8 }}>{fmtDate(t.created)} ¬∑ {SL[t.status]}</div>
              {t.notes && <div style={{ background: C.cd, borderRadius: 8, padding: 12, fontSize: 13, color: "#94a3b8", marginBottom: 10, lineHeight: 1.6 }}>{t.notes}</div>}
              <div style={{ display: "flex", gap: 6, marginTop: 8 }}>
                {!done && ["backlog", "in-progress", "review", "done"].filter(s => s !== t.status).map(s => (
                  <button key={s} onClick={() => move(t.id, s)} style={{
                    padding: "5px 12px", background: C.br, border: "none",
                    borderRadius: 6, color: C.sub, fontSize: 11, cursor: "pointer", fontFamily: "inherit"
                  }}>‚Üí {SL[s]}</button>
                ))}
                <button onClick={() => del(t.id)} style={{
                  padding: "5px 12px", background: `${C.red}15`, border: `1px solid ${C.red}30`,
                  borderRadius: 6, color: C.red, fontSize: 11, cursor: "pointer", marginLeft: "auto", fontFamily: "inherit"
                }}>Delete</button>
              </div>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
